import streamlit as st
import pandas as pd
import plotly.graph_objects as go
import numpy as np

# -----------------------------------------------------------------------------
# 1. í˜ì´ì§€ ì„¤ì • & ìŠ¤íƒ€ì¼
# -----------------------------------------------------------------------------
st.set_page_config(
    page_title="Career Compass Pro",
    page_icon="ğŸ§­",
    layout="wide",
    initial_sidebar_state="expanded"
)

# UI/UX ìŠ¤íƒ€ì¼ë§
st.markdown("""
<style>
    .main-header { font-size: 2.2rem; font-weight: 700; color: #1E3A8A; margin-bottom: 1rem; }
    .sub-header { font-size: 1.1rem; color: #64748B; margin-bottom: 2rem; }
    .question-box { background-color: #F8FAFC; padding: 15px; border-radius: 10px; margin-bottom: 10px; border-left: 4px solid #3B82F6; }
    .info-box { background-color: #F1F5F9; padding: 20px; border-radius: 12px; margin-bottom: 15px; }
    .tag-base { display: inline-block; padding: 4px 10px; border-radius: 15px; font-size: 0.85rem; font-weight: 600; margin: 3px; }
    .tag-gen { background-color: #DBEAFE; color: #1E40AF; border: 1px solid #BFDBFE; }
    .tag-career { background-color: #FEF3C7; color: #92400E; border: 1px solid #FDE68A; }
    .step-indicator { padding: 8px 16px; background-color: #EFF6FF; border-radius: 20px; color: #1D4ED8; font-weight: bold; margin-bottom: 15px; display: inline-block; }
</style>
""", unsafe_allow_html=True)

# -----------------------------------------------------------------------------
# 2. ë°ì´í„° ì„¼í„° (êµ¬ê¸€ ì‹œíŠ¸ ì§ˆë¬¸ + ì§ì—… ë°ì´í„°)
# -----------------------------------------------------------------------------
@st.cache_data
def load_data():
    # 1. êµ¬ê¸€ ì‹œíŠ¸ ì§ˆë¬¸ ë°ì´í„° (í•˜ë“œì½”ë”© - ì—°ë™ ì‹¤íŒ¨ ì‹œ ì•ˆì „ì¥ì¹˜)
    # ì‹¤ì œë¡œëŠ” gsheets connectionì„ ì“°ë©´ ì¢‹ì§€ë§Œ, ì—¬ê¸°ì„œëŠ” ìš”ì²­í•˜ì‹  ë°ì´í„°ë¥¼ ê·¸ëŒ€ë¡œ ë„£ì—ˆìŠµë‹ˆë‹¤.
    questions = [
        {"id": "Q1", "text": "ë“œë¡ , 3D í”„ë¦°í„° ë“± ìƒˆë¡œìš´ ê¸°ê³„ë¥¼ ì¡°ì‘í•˜ê³  ê²°ê³¼ë¬¼ì„ ë§Œë“œëŠ” ê²ƒì´ ì¦ê²ë‹¤.", "type": "R"},
        {"id": "Q2", "text": "ê°€êµ¬ ì¡°ë¦½ì´ë‚˜ ì „ìì œí’ˆ ìˆ˜ë¦¬ì²˜ëŸ¼ ì†ëì˜ ê°ê°ì„ ì‚¬ìš©í•˜ëŠ” ì¼ì„ ì˜í•œë‹¤.", "type": "R"},
        {"id": "Q3", "text": "ì‹¤ë‚´ì— ì•‰ì•„ìˆëŠ” ê²ƒë³´ë‹¤ ì•¼ì™¸ì—ì„œ ëª¸ì„ ì›€ì§ì´ë©° ë•€ í˜ë¦¬ëŠ” í™œë™ì„ ì„ í˜¸í•œë‹¤.", "type": "R"},
        {"id": "Q4", "text": "ì‹ë¬¼ì„ í‚¤ìš°ê±°ë‚˜ ë™ë¬¼ì„ ëŒë³´ëŠ” ë“± ìƒëª…ì²´ë¥¼ ë‹¤ë£¨ëŠ” ì¼ì— ê´€ì‹¬ì´ ìˆë‹¤.", "type": "R"},
        {"id": "Q5", "text": "ë³µì¡í•œ ì„¤ê³„ë„ë‚˜ ì§€ë„ë¥¼ ë³´ê³  ì…ì²´ì ì¸ êµ¬ì¡°ë¥¼ íŒŒì•…í•˜ëŠ” ê²ƒì´ ë¹ ë¥´ë‹¤.", "type": "R"},
        {"id": "Q6", "text": "ìš´ë™ ê²½ê¸°ì—ì„œ ì „ëµë³´ë‹¤ëŠ” ì‹ ì²´ì ì¸ ëŠ¥ë ¥ê³¼ ê¸°ìˆ ì„ ë°œíœ˜í•˜ëŠ” í¬ì§€ì…˜ì´ ì¢‹ë‹¤.", "type": "R"},
        {"id": "Q7", "text": "ì‚¬íšŒ ì´ìŠˆë‚˜ ìì—° í˜„ìƒì„ ë³¼ ë•Œ 'ê·¼ë³¸ì ì¸ ì›ì¸'ì´ ë¬´ì—‡ì¸ì§€ ë¶„ì„í•˜ë ¤ í•œë‹¤.", "type": "I"},
        {"id": "Q8", "text": "ìˆ˜í•™ ë‚œì œë‚˜ ì¶”ë¦¬ ì†Œì„¤ì˜ ë²”ì¸ì„ ì°¾ì„ ë•Œê¹Œì§€ ëˆì§ˆê¸°ê²Œ íŒŒê³ ë“ ë‹¤.", "type": "I"},
        {"id": "Q9", "text": "ê°ê´€ì ì¸ ë°ì´í„°ì™€ í†µê³„ ìë£Œë¥¼ ê·¼ê±°ë¡œ ì£¼ì¥í•˜ëŠ” ê²ƒì„ ì„ í˜¸í•œë‹¤.", "type": "I"},
        {"id": "Q10", "text": "ì¸ê³µì§€ëŠ¥, ìš°ì£¼, ë‡Œê³¼í•™ ë“± ë¯¸ì§€ì˜ ì˜ì—­ì„ íƒêµ¬í•˜ëŠ” ë‹¤íë©˜í„°ë¦¬ë¥¼ ì¦ê²¨ ë³¸ë‹¤.", "type": "I"},
        {"id": "Q11", "text": "ì‹¤í—˜ì„ í†µí•´ ê°€ì„¤ì„ ê²€ì¦í•˜ê³  ìƒˆë¡œìš´ ì‚¬ì‹¤ì„ ë°œê²¬í–ˆì„ ë•Œ í¬ì—´ì„ ëŠë‚€ë‹¤.", "type": "I"},
        {"id": "Q12", "text": "ë…¼ë¦¬ì  ëª¨ìˆœì„ ì°¾ì•„ë‚´ê±°ë‚˜ ë¹„íŒì ìœ¼ë¡œ ì‚¬ê³ í•˜ëŠ” í† ë¡  ìˆ˜ì—…ì´ ì¬ë¯¸ìˆë‹¤.", "type": "I"},
        {"id": "Q13", "text": "ì •í•´ì§„ ì–‘ì‹ë³´ë‹¤ëŠ” ë‚˜ë§Œì˜ ìŠ¤íƒ€ì¼ë¡œ PPTë‚˜ ë³´ê³ ì„œë¥¼ ê¾¸ë¯¸ëŠ” ê²ƒì„ ì¢‹ì•„í•œë‹¤.", "type": "A"},
        {"id": "Q14", "text": "ê¸€, ê·¸ë¦¼, ì˜ìƒ, ìŒì•… ë“±ì„ í†µí•´ ë‚˜ì˜ ê°ì •ì„ í‘œí˜„í•˜ëŠ” ê²ƒì´ ìµìˆ™í•˜ë‹¤.", "type": "A"},
        {"id": "Q15", "text": "ë‚¨ë“¤ì´ ìƒê°í•˜ì§€ ëª»í•œ ê¸°ë°œí•œ ì•„ì´ë””ì–´ë¡œ ì¹œêµ¬ë“¤ì„ ë†€ë¼ê²Œ í•œ ì ì´ ìˆë‹¤.", "type": "A"},
        {"id": "Q16", "text": "ììœ ë¡œìš´ ë¶„ìœ„ê¸°ì—ì„œ ìƒìƒë ¥ì„ ë°œíœ˜í•  ìˆ˜ ìˆëŠ” í™˜ê²½ì„ ì„ í˜¸í•œë‹¤.", "type": "A"},
        {"id": "Q17", "text": "ì˜í™”ë‚˜ ì†Œì„¤ì„ ë³¼ ë•Œ ë“±ì¥ì¸ë¬¼ì˜ ê°ì •ì— ê¹Šì´ ì´ì…í•˜ì—¬ ëˆˆë¬¼ì„ í˜ë¦¬ê³¤ í•œë‹¤.", "type": "A"},
        {"id": "Q18", "text": "ìœ í–‰ì„ ë”°ë¥´ê¸°ë³´ë‹¤ ë‚˜ë§Œì˜ ê°œì„±ì´ ë“œëŸ¬ë‚˜ëŠ” ì˜·ì´ë‚˜ ì†Œí’ˆì„ ì¢‹ì•„í•œë‹¤.", "type": "A"},
        {"id": "Q19", "text": "ì¹œêµ¬ì˜ ê³ ë¯¼ì„ ë“¤ì–´ì£¼ê³  ê·¸ë“¤ì˜ ê°ì •ì„ ìœ„ë¡œí•´ ì£¼ëŠ” ë°ì„œ ë³´ëŒì„ ëŠë‚€ë‹¤.", "type": "S"},
        {"id": "Q20", "text": "ì–´ë ¤ìš´ ê°œë…ì„ ì¹œêµ¬ë“¤ì´ ì´í•´í•˜ê¸° ì‰½ê²Œ ì„¤ëª…í•´ ì£¼ëŠ” ê²ƒì„ ì˜í•œë‹¤.", "type": "S"},
        {"id": "Q21", "text": "ë´‰ì‚¬í™œë™ì´ë‚˜ ë©˜í† ë§ì²˜ëŸ¼ íƒ€ì¸ì˜ ì„±ì¥ì„ ë•ëŠ” í™œë™ì— ì ê·¹ì ì´ë‹¤.", "type": "S"},
        {"id": "Q22", "text": "í˜¼ì ì¼í•˜ëŠ” ê²ƒë³´ë‹¤ íŒ€ì›ë“¤ê³¼ í˜‘ë ¥í•˜ì—¬ ì‹œë„ˆì§€ë¥¼ ë‚´ëŠ” ê²ƒì„ ì„ í˜¸í•œë‹¤.", "type": "S"},
        {"id": "Q23", "text": "ì‚¬íšŒì  ì•½ìë‚˜ ì¸ê¶Œ ë¬¸ì œì— ê´€ì‹¬ì´ ë§ê³  ì´ë¥¼ ê°œì„ í•˜ê³  ì‹¶ë‹¤.", "type": "S"},
        {"id": "Q24", "text": "ë‚¯ì„  ì‚¬ëŒê³¼ë„ ê¸ˆë°© ì¹œí•´ì§€ê³  ëŒ€í™”ë¥¼ ì´ëŒì–´ê°€ëŠ” ì‚¬êµì„±ì´ ìˆë‹¤.", "type": "S"},
        {"id": "Q25", "text": "í•™ê¸‰ íšŒì¥ì´ë‚˜ ë™ì•„ë¦¬ ëŒ€í‘œì²˜ëŸ¼ ë¦¬ë”ì‹­ì„ ë°œíœ˜í•˜ëŠ” ìë¦¬ê°€ í¸í•˜ë‹¤.", "type": "E"},
        {"id": "Q26", "text": "ëª©í‘œë¥¼ ë‹¬ì„±í•˜ê¸° ìœ„í•´ ì‚¬ëŒë“¤ì„ ì„¤ë“í•˜ê³  í˜‘ìƒí•˜ëŠ” ê³¼ì •ì´ ì¦ê²ë‹¤.", "type": "E"},
        {"id": "Q27", "text": "ì‹¤íŒ¨ë¥¼ ë‘ë ¤ì›Œí•˜ê¸°ë³´ë‹¤ ë„ì „ì ì¸ ê³¼ì œì— ë¶€ë”ªí˜€ ì„±ì·¨í•˜ëŠ” ê²ƒì„ ì¦ê¸´ë‹¤.", "type": "E"},
        {"id": "Q28", "text": "ë‚˜ì˜ ë…¸ë ¥ì— ë”°ë¼ ë³´ìƒì´ í™•ì‹¤í•˜ê²Œ ì£¼ì–´ì§€ëŠ” ê²½ìŸì ì¸ í™˜ê²½ì„ ì„ í˜¸í•œë‹¤.", "type": "E"},
        {"id": "Q29", "text": "ê²½ì œ íë¦„, ì°½ì—…, ë§ˆì¼€íŒ… ì „ëµ ë“± ë¹„ì¦ˆë‹ˆìŠ¤ ì„¸ê³„ì— ê´€ì‹¬ì´ ë§ë‹¤.", "type": "E"},
        {"id": "Q30", "text": "ëŒ€ì¤‘ ì•ì—ì„œ ë‚˜ì˜ ì˜ê²¬ì„ ë°œí‘œí•˜ê³  ì£¼ëª©ë°›ëŠ” ê²ƒì„ ì¦ê¸´ë‹¤.", "type": "E"},
        {"id": "Q31", "text": "ê³„íšì„ ì„¸ì›Œ ì‹œê°„ê³¼ ëˆì„ ì²´ê³„ì ìœ¼ë¡œ ê´€ë¦¬í•˜ëŠ” ìŠµê´€ì´ ìˆë‹¤.", "type": "C"},
        {"id": "Q32", "text": "ë¬¸ì„œì˜ ì˜¤íƒ€ë¥¼ ì°¾ê±°ë‚˜ ìˆ«ìë¥¼ ì •í™•í•˜ê²Œ ê³„ì‚°í•˜ëŠ” ê¼¼ê¼¼í•¨ì´ ìˆë‹¤.", "type": "C"},
        {"id": "Q33", "text": "ì •í•´ì§„ ê·œì¹™ê³¼ ë§¤ë‰´ì–¼ì„ ì¤€ìˆ˜í•˜ë©° ì•ˆì •ì ìœ¼ë¡œ ì¼í•˜ëŠ” ê²ƒì„ ì„ í˜¸í•œë‹¤.", "type": "C"},
        {"id": "Q34", "text": "ë³µì¡í•œ ìë£Œë¥¼ ë³´ê¸° ì¢‹ê²Œ ì •ë¦¬í•˜ê³  ë¶„ë¥˜í•˜ëŠ” ê²ƒì„ ì˜í•œë‹¤.", "type": "C"},
        {"id": "Q35", "text": "ì˜ˆì¸¡ ë¶ˆê°€ëŠ¥í•œ ëª¨í—˜ë³´ë‹¤ëŠ” í™•ì‹¤í•˜ê³  ì•ˆì „í•œ ì„ íƒì„ í•˜ëŠ” í¸ì´ë‹¤.", "type": "C"},
        {"id": "Q36", "text": "ì±…ì„ê°ì´ ê°•í•˜ê³  ë§¡ì€ ì¼ì€ ëê¹Œì§€ ì„±ì‹¤í•˜ê²Œ ë§ˆë¬´ë¦¬í•œë‹¤.", "type": "C"},
    ]
    
    # 2. ì§ì—… ë°ì´í„°
    df_jobs = pd.DataFrame({
        'ì§ì—…êµ°': [
            'ì†Œí”„íŠ¸ì›¨ì–´ ê°œë°œì', 'ë°ì´í„° ì‚¬ì´ì–¸í‹°ìŠ¤íŠ¸', 'ì •ë³´ë³´ì•ˆ ì „ë¬¸ê°€', 'AI ì—°êµ¬ì›', 'ë°˜ë„ì²´ ì—”ì§€ë‹ˆì–´',
            'ì˜ì‚¬ (ì „ë¬¸ì˜)', 'ì•½ì‚¬', 'ê°„í˜¸ì‚¬', 'ìˆ˜ì˜ì‚¬', 'ì¹˜ê³¼ì˜ì‚¬',
            'ê²½ì˜ ì»¨ì„¤í„´íŠ¸', 'ê³µì¸íšŒê³„ì‚¬(CPA)', 'íˆ¬ìì€í–‰ê°€(IB)', 'ë§ˆì¼€íŒ… ì „ë¬¸ê°€', 'ê´€ì„¸ì‚¬',
            'ë³€í˜¸ì‚¬ (ë¡œìŠ¤ì¿¨)', 'íŒì‚¬/ê²€ì‚¬', 'ë³€ë¦¬ì‚¬', 'ë…¸ë¬´ì‚¬', 'ê²½ì°°ê³µë¬´ì›',
            '5ê¸‰ í–‰ì •ê³ ì‹œ', '7/9ê¸‰ ê³µë¬´ì›', 'ì™¸êµê´€', 'ì¤‘ë“± êµì‚¬', 'ëŒ€í•™êµìˆ˜',
            'ë°©ì†¡ PD', 'ê¸°ì', 'ì›¹íˆ° ì‘ê°€', 'íë ˆì´í„°', 'í•­ê³µê¸° ì¡°ì¢…ì‚¬'
        ],
        'Holland_Code': [
            'IR', 'IC', 'IC', 'IR', 'RI',
            'IS', 'SC', 'SI', 'IR', 'IR',
            'EC', 'CE', 'EC', 'AE', 'CE',
            'EI', 'EI', 'IE', 'ES', 'SE',
            'ES', 'CS', 'SA', 'SA', 'IA',
            'AE', 'EI', 'AI', 'AE', 'RI'
        ],
        'Money': [45, 50, 45, 50, 50, 60, 45, 35, 45, 55, 55, 50, 60, 35, 40, 55, 50, 50, 40, 30, 35, 25, 40, 30, 40, 35, 30, 40, 25, 55],
        'WLB':   [25, 25, 20, 20, 15, 10, 35, 15, 25, 25, 5, 10, 5, 25, 30, 5, 10, 15, 30, 15, 15, 35, 15, 35, 35, 5, 5, 20, 30, 20],
        'Culture':[35, 30, 25, 25, 15, 10, 15, 10, 15, 15, 10, 15, 5, 40, 15, 10, 5, 15, 20, 5, 10, 10, 15, 15, 20, 30, 20, 40, 25, 10],
        'Location':[15, 15, 15, 10, 10, 20, 20, 25, 20, 20, 25, 25, 25, 20, 20, 25, 20, 20, 20, 10, 30, 15, 10, 15, 10, 25, 20, 10, 20, 10],
        'Stability':[20, 25, 30, 25, 30, 60, 50, 40, 50, 55, 15, 40, 10, 15, 40, 30, 50, 45, 35, 50, 55, 60, 50, 55, 50, 20, 25, 10, 20, 40]
    })
    
    # 3. ìƒì„¸ ì§„ë¡œ ê°€ì´ë“œ (ì¼ë¶€ ì˜ˆì‹œ)
    guide = {
        "ì†Œí”„íŠ¸ì›¨ì–´ ê°œë°œì": {"major": "ì»´í“¨í„°ê³µí•™, ì†Œí”„íŠ¸ì›¨ì–´í•™", "hs_g": "ìˆ˜í•™I/II, ë¯¸ì ë¶„, ë¬¼ë¦¬í•™I, ì •ë³´", "hs_c": "ì¸ê³µì§€ëŠ¥ ìˆ˜í•™, ì •ë³´ê³¼í•™", "steps": ["CS ê¸°ì´ˆ(ìë£Œêµ¬ì¡°/ì•Œê³ ë¦¬ì¦˜)", "ë‚˜ë§Œì˜ ì›¹/ì•± í”„ë¡œì íŠ¸ ë°°í¬", "ì½”ë”©í…ŒìŠ¤íŠ¸ ë° ê¸°ìˆ ë©´ì ‘"]},
        "ë°ì´í„° ì‚¬ì´ì–¸í‹°ìŠ¤íŠ¸": {"major": "í†µê³„í•™, ì‚°ì—…ê³µí•™, ë°ì´í„°ì‚¬ì´ì–¸ìŠ¤", "hs_g": "í™•ë¥ ê³¼ í†µê³„, ë¯¸ì ë¶„, ì‚¬íšŒë¬¸ì œíƒêµ¬", "hs_c": "ì‹¤ìš© í†µê³„, ìˆ˜í•™ê³¼ì œ íƒêµ¬", "steps": ["Python/SQL ë° í†µê³„í•™ ë§ˆìŠ¤í„°", "Kaggle ë“± ë¶„ì„ ëŒ€íšŒ ì°¸ì—¬", "ì„ì‚¬ ì§„í•™ ë˜ëŠ” ì‹¤ë¬´ í”„ë¡œì íŠ¸"]},
        "ì˜ì‚¬ (ì „ë¬¸ì˜)": {"major": "ì˜ì˜ˆê³¼", "hs_g": "ìƒëª…ê³¼í•™I, í™”í•™I, ë¯¸ì ë¶„", "hs_c": "ìƒëª…ê³¼í•™II, í™”í•™II", "steps": ["ì˜ëŒ€ 6ë…„(ì˜ˆê³¼+ë³¸ê³¼)", "ì˜ì‚¬ êµ­ê°€ê³ ì‹œ í•©ê²©", "ì¸í„´ 1ë…„ + ë ˆì§€ë˜íŠ¸ 3~4ë…„"]},
        "ê²½ì˜ ì»¨ì„¤í„´íŠ¸": {"major": "ê²½ì˜í•™, ê²½ì œí•™, ì‚°ì—…ê³µí•™", "hs_g": "ê²½ì œ, ì‚¬íšŒë¬¸í™”, ì˜ì–´íšŒí™”", "hs_c": "êµ­ì œ ê²½ì œ, ì‚¬íšŒë¬¸ì œ íƒêµ¬", "steps": ["ì „ëµ í•™íšŒ í™œë™ ë° ê³µëª¨ì „", "RA(Research Assistant) ì¸í„´", "Case Interview ì¤€ë¹„"]},
        "5ê¸‰ í–‰ì •ê³ ì‹œ": {"major": "í–‰ì •í•™, ê²½ì œí•™, ì •ì¹˜ì™¸êµ", "hs_g": "ì •ì¹˜ì™€ ë²•, í•œêµ­ì‚¬, ê²½ì œ", "hs_c": "êµ­ì œ ì •ì¹˜, ì§€ì—­ ì´í•´", "steps": ["PSAT(1ì°¨) ë° í•œêµ­ì‚¬/ì˜ì–´", "2ì°¨ ì „ê³µ ë…¼ìˆ (ê²½ì œ/í–‰ì •ë²•)", "3ì°¨ ì‹¬ì¸µ ë©´ì ‘"]},
        "ë°˜ë„ì²´ ì—”ì§€ë‹ˆì–´": {"major": "ì „ìê³µí•™, ì‹ ì†Œì¬ê³µí•™", "hs_g": "ë¬¼ë¦¬í•™I/II, í™”í•™I, ë¯¸ì ë¶„", "hs_c": "ê³µí•™ ì¼ë°˜, ê³ ê¸‰ ë¬¼ë¦¬í•™", "steps": ["íšŒë¡œì´ë¡ /ë°˜ë„ì²´ê³µí•™ í•™ì  ê´€ë¦¬", "ë°˜ë„ì²´ ê³µì • ì‹¤ìŠµ ê²½í—˜", "ëŒ€ê¸°ì—… ì§ë¬´ì ì„±ê²€ì‚¬(GSAT ë“±)"]},
        "ê³µì¸íšŒê³„ì‚¬(CPA)": {"major": "ê²½ì˜í•™, íšŒê³„í•™, ì„¸ë¬´í•™", "hs_g": "ê²½ì œ, í™•ë¥ ê³¼ í†µê³„", "hs_c": "ê²½ì œ ìˆ˜í•™, ì‹¤ìš© ê²½ì œ", "steps": ["í•™ì  ì´ìˆ˜ ë° í† ìµ ì ìˆ˜ í™•ë³´", "1ì°¨ ì‹œí—˜(ê°ê´€ì‹)", "2ì°¨ ì‹œí—˜(ì„œìˆ í˜•)"]},
        "ë³€í˜¸ì‚¬ (ë¡œìŠ¤ì¿¨)": {"major": "ììœ ì „ê³µ, ì •ì¹˜ì™¸êµ, ê²½ì œ", "hs_g": "ì •ì¹˜ì™€ ë²•, ìƒí™œê³¼ ìœ¤ë¦¬, í™”ì‘", "hs_c": "ì‚¬íšŒë¬¸ì œ íƒêµ¬, ê³ ì „ ì½ê¸°", "steps": ["í•™ì (GPA) ë° í† ìµ ê³ ë“ì ", "LEET(ë²•í•™ì ì„±ì‹œí—˜) ì¤€ë¹„", "ë¡œìŠ¤ì¿¨ 3ë…„ + ë³€í˜¸ì‚¬ ì‹œí—˜"]},
        "ì¤‘ë“± êµì‚¬": {"major": "ì‚¬ë²”ëŒ€í•™(í•´ë‹¹ ì „ê³µ)", "hs_g": "êµìœ¡í•™(ì„ íƒ), ì „ê³µ ê´€ë ¨ ê³¼ëª©", "hs_c": "êµìœ¡í•™, ì‹¬ë¦¬í•™", "steps": ["êµì› ìê²©ì¦ ì·¨ë“", "ì„ìš©ê³ ì‹œ 1ì°¨(êµìœ¡í•™/ì „ê³µ)", "ì„ìš©ê³ ì‹œ 2ì°¨(ìˆ˜ì—…ì‹¤ì—°/ë©´ì ‘)"]},
        "ë°©ì†¡ PD": {"major": "ì‹ ë¬¸ë°©ì†¡í•™, ë¯¸ë””ì–´ì»¤ë®¤ë‹ˆì¼€ì´ì…˜", "hs_g": "ì–¸ì–´ì™€ ë§¤ì²´, ì‚¬íšŒë¬¸í™”", "hs_c": "ë§¤ì²´ì™€ ë¹„í‰, ì˜ìƒ ì œì‘", "steps": ["ì˜ìƒ ì œì‘ ê²½í—˜(ë™ì•„ë¦¬/ìœ íŠœë¸Œ)", "ì‘ë¬¸/ë…¼ìˆ (ì–¸ë¡ ê³ ì‹œ) ì¤€ë¹„", "ì‹¤ë¬´ ë©´ì ‘ ë° ê¸°íšì•ˆ í‰ê°€"]},
        "ì•½ì‚¬": {"major": "ì•½í•™ê³¼", "hs_g": "í™”í•™I, ìƒëª…ê³¼í•™I, ë¯¸ì ë¶„", "hs_c": "í™”í•™II, ìœµí•©ê³¼í•™ íƒêµ¬", "steps": ["ì•½ëŒ€ 6ë…„ ê³¼ì • ì…í•™", "ì•½í•™ í•„ìˆ˜ ì‹¤ë¬´ ì‹¤ìŠµ", "ì•½ì‚¬ ë©´í—ˆ ì‹œí—˜ í•©ê²©"]},
        "ê°„í˜¸ì‚¬": {"major": "ê°„í˜¸í•™ê³¼", "hs_g": "ìƒëª…ê³¼í•™I, ìƒí™œê³¼ ìœ¤ë¦¬", "hs_c": "ë³´ê±´ ê°„í˜¸, ì¸ì²´ êµ¬ì¡°ì™€ ê¸°ëŠ¥", "steps": ["ê°„í˜¸í•™ê³¼ 4ë…„ ì¡¸ì—…", "ê°„í˜¸ì‚¬ êµ­ê°€ê³ ì‹œ í•©ê²©", "ëŒ€í•™ë³‘ì›/ì¢…í•©ë³‘ì› ì·¨ì—…"]},
        "í•­ê³µê¸° ì¡°ì¢…ì‚¬": {"major": "í•­ê³µìš´í•­í•™ê³¼", "hs_g": "ë¬¼ë¦¬í•™I, ì§€êµ¬ê³¼í•™I, ì˜ì–´", "hs_c": "ê³ ê¸‰ ì§€êµ¬ê³¼í•™", "steps": ["ë¹„í–‰ êµìœ¡ì› ì…êµ ë° ë©´ì¥ ì·¨ë“", "ë¹„í–‰ ì‹œê°„(íƒ€ì„ë¹Œë”©) ì¶•ì ", "í•­ê³µì‚¬ ì…ì‚¬"]},
    }
    
    return questions, df_jobs, guide

questions, df_jobs, career_guide = load_data()

# -----------------------------------------------------------------------------
# 3. ì‚¬ì´ë“œë°” (ìƒíƒœ ê´€ë¦¬)
# -----------------------------------------------------------------------------
if 'step' not in st.session_state:
    st.session_state.step = 1

with st.sidebar:
    st.header("ğŸ§­ ì§„í–‰ ìƒí™©")
    
    if st.session_state.step == 1:
        st.markdown("<div class='step-indicator'>STEP 1. ì •ë°€ ì ì„± ê²€ì‚¬</div>", unsafe_allow_html=True)
        st.info("36ê°œì˜ ë¬¸í•­ì— ë‹µí•˜ì—¬ ë‚˜ì˜ ì ì„±ì„ ë¶„ì„í•©ë‹ˆë‹¤.")
        # ì§„í–‰ë¥  í‘œì‹œ
        if 'responses' in st.session_state:
            answered = len(st.session_state.responses)
            st.progress(answered / 36)
            st.caption(f"ì§„í–‰ë¥ : {answered}/36")
    elif st.session_state.step == 2:
        st.markdown("<div class='step-indicator'>STEP 2. ê°€ì¹˜ê´€ ì„¤ì •</div>", unsafe_allow_html=True)
        st.info("ì§ì—… ì„ íƒ ì‹œ ë¬´ì—‡ì„ ì¤‘ìš”í•˜ê²Œ ìƒê°í•˜ì‹œë‚˜ìš”?")
    else:
        st.markdown("<div class='step-indicator'>STEP 3. ê²°ê³¼ í™•ì¸</div>", unsafe_allow_html=True)
        st.success("ë¶„ì„ ì™„ë£Œ! ì¶”ì²œ ì§ì—…ê³¼ ìƒì„¸ ë¡œë“œë§µì„ í™•ì¸í•˜ì„¸ìš”.")
        if st.button("ğŸ”„ ì²˜ìŒë¶€í„° ë‹¤ì‹œ í•˜ê¸°"):
            st.session_state.step = 1
            st.session_state.responses = {}
            st.rerun()
            
    st.divider()
    st.caption("Created by Plant the Seed ğŸŒ±")

# -----------------------------------------------------------------------------
# 4. ë©”ì¸ ì½˜í…ì¸ 
# -----------------------------------------------------------------------------

# =============================================================================
# [STEP 1] í™€ë€ë“œ ì •ë°€ ê²€ì‚¬ (36ë¬¸í•­)
# =============================================================================
if st.session_state.step == 1:
    st.markdown("<h1 class='main-header'>ğŸ•µï¸â€â™€ï¸ STEP 1. ì§ì—… ì ì„± ì •ë°€ ì§„ë‹¨</h1>", unsafe_allow_html=True)
    st.markdown("<p class='sub-header'>ë‹¤ìŒ ë¬¸í•­ë“¤ì„ ì½ê³ , í‰ì†Œ ìì‹ ì˜ ìƒê°ì´ë‚˜ í–‰ë™ê³¼ ì–¼ë§ˆë‚˜ ì¼ì¹˜í•˜ëŠ”ì§€ ì„ íƒí•´ì£¼ì„¸ìš”.<br>(1ì : ì „í˜€ ì•„ë‹ˆë‹¤ ~ 5ì : ë§¤ìš° ê·¸ë ‡ë‹¤)</p>", unsafe_allow_html=True)
    
    # ì‘ë‹µ ì €ì¥ì†Œ ì´ˆê¸°í™”
    if 'responses' not in st.session_state:
        st.session_state.responses = {}

    # 36ê°œ ì§ˆë¬¸ì„ íƒ­ì´ë‚˜ í˜ì´ì§€ë¡œ ë‚˜ëˆ„ì§€ ì•Šê³  í•œ ë²ˆì— ìŠ¤í¬ë¡¤ë¡œ ë³´ì—¬ì¤Œ (ì‚¬ìš©ì„± ê³ ë ¤)
    # ë„ˆë¬´ ê¸¸ì–´ì§€ëŠ” ê²ƒì„ ë°©ì§€í•˜ê¸° ìœ„í•´ 6ê°œì”© ëŠì–´ì„œ Expanderë¡œ ë³´ì—¬ì£¼ê±°ë‚˜, ê·¸ëŒ€ë¡œ ë‚˜ì—´
    
    # RIASEC ìœ í˜•ë³„ ì ìˆ˜ ê³„ì‚°ì„ ìœ„í•´ í¼ ì‚¬ìš©
    with st.form("holland_form"):
        # 6ê°œì”© ê·¸ë£¹ì§€ì–´ ë³´ì—¬ì£¼ê¸° (R, I, A, S, E, C ìˆœì„œëŒ€ë¡œ ë˜ì–´ìˆìŒ)
        types = ['R (í˜„ì‹¤í˜•)', 'I (íƒêµ¬í˜•)', 'A (ì˜ˆìˆ í˜•)', 'S (ì‚¬íšŒí˜•)', 'E (ì§„ì·¨í˜•)', 'C (ê´€ìŠµí˜•)']
        
        for i, q in enumerate(questions):
            # 6ë¬¸ì œë§ˆë‹¤ í—¤ë” ì¶œë ¥ (ìœ í˜• êµ¬ë¶„ì„ ìœ„í•´)
            if i % 6 == 0:
                type_idx = i // 6
                st.markdown(f"### ğŸ“Œ Part {type_idx + 1}")
            
            st.markdown(f"""
            <div class="question-box">
                <b>Q{i+1}.</b> {q['text']}
            </div>
            """, unsafe_allow_html=True)
            
            # ë¼ë””ì˜¤ ë²„íŠ¼ì„ ê°€ë¡œë¡œ ë°°ì¹˜í•˜ì—¬ 1~5ì  ì„ íƒ
            st.radio(
                label=f"Q{i+1} ì‘ë‹µ",
                options=[1, 2, 3, 4, 5],
                index=2, # ê¸°ë³¸ê°’ 3ì 
                horizontal=True,
                key=f"q_{q['id']}", # ê³ ìœ  í‚¤
                label_visibility="collapsed"
            )
            st.write("") # ê°„ê²©

        submit_button = st.form_submit_button("ê²€ì‚¬ ì™„ë£Œ ë° ë‹¤ìŒ ë‹¨ê³„ â¡ï¸", type="primary")

    if submit_button:
        # ì ìˆ˜ ê³„ì‚°
        scores = {'R': 0, 'I': 0, 'A': 0, 'S': 0, 'E': 0, 'C': 0}
        
        for q in questions:
            # session_stateì—ì„œ ê°’ ê°€ì ¸ì˜¤ê¸°
            val = st.session_state.get(f"q_{q['id']}", 3)
            scores[q['type']] += val
            
        # ìƒìœ„ 2ê°œ ìœ í˜• ì¶”ì¶œ
        sorted_scores = sorted(scores.items(), key=lambda x: x[1], reverse=True)
        top_code = sorted_scores[0][0] + sorted_scores[1][0]
        
        st.session_state.holland_code = top_code
        st.session_state.holland_scores = scores
        st.session_state.step = 2
        st.rerun()

# =============================================================================
# [STEP 2] ê°€ì¹˜ê´€ ë°¸ëŸ°ìŠ¤ ê²Œì„
# =============================================================================
elif st.session_state.step == 2:
    st.markdown("<h1 class='main-header'>âš–ï¸ STEP 2. ì§ì—… ê°€ì¹˜ê´€ ë°¸ëŸ°ìŠ¤</h1>", unsafe_allow_html=True)
    st.markdown(f"<p class='sub-header'>ë‹¹ì‹ ì˜ ì ì„± ìœ í˜•ì€ <b>[{st.session_state.holland_code}í˜•]</b> ì…ë‹ˆë‹¤.<br>ì´ì œ ì§ì—… ì„ íƒ ì‹œ ì¤‘ìš”í•˜ê²Œ ìƒê°í•˜ëŠ” ìš”ì†Œì˜ ë¹„ì¤‘ì„ ì •í•´ì£¼ì„¸ìš”.</p>", unsafe_allow_html=True)

    col_input, col_chart = st.columns([1, 1])
    
    with col_input:
        v_money = st.slider("ğŸ’° **ëˆ (Money)** : ë†’ì€ ì—°ë´‰ê³¼ ë³´ìƒ", 0, 100, 50)
        v_wlb = st.slider("ğŸ§˜ **ì›Œë¼ë°¸ (WLB)** : ì €ë…ì´ ìˆëŠ” ì‚¶, íœ´ì‹", 0, 100, 50)
        v_culture = st.slider("ğŸ¨ **ë¬¸í™” (Culture)** : ìˆ˜í‰ì ì´ê³  ììœ ë¡œìš´ ë¶„ìœ„ê¸°", 0, 100, 20)
        v_loc = st.slider("ğŸ“ **ê·¼ë¬´ì§€ (Location)** : ì„œìš¸/ìˆ˜ë„ê¶Œ, ì¶œí‡´ê·¼ í¸ì˜", 0, 100, 30)
        v_stable = st.slider("ğŸ›¡ï¸ **ì•ˆì •ì„± (Stability)** : ì •ë…„ ë³´ì¥, ë‚®ì€ í•´ê³  ìœ„í—˜", 0, 100, 50)

    total = v_money + v_wlb + v_culture + v_loc + v_stable
    if total == 0: total = 1
    user_vec = [(x/total)*100 for x in [v_money, v_wlb, v_culture, v_loc, v_stable]]
    st.session_state.user_vector = user_vec

    with col_chart:
        fig = go.Figure(go.Scatterpolar(
            r=user_vec + [user_vec[0]],
            theta=['ëˆ', 'ì›Œë¼ë°¸', 'ë¬¸í™”', 'ê·¼ë¬´ì§€', 'ì•ˆì •ì„±', 'ëˆ'],
            fill='toself',
            name='ë‚˜ì˜ ê°€ì¹˜ê´€',
            line_color='#3B82F6'
        ))
        fig.update_layout(polar=dict(radialaxis=dict(visible=True, range=[0, 40])), showlegend=False, height=350, title="ë‚˜ì˜ ê°€ì¹˜ê´€ ë‹¤ì´ì•„ëª¬ë“œ")
        st.plotly_chart(fig, use_container_width=True)

    if st.button("ê²°ê³¼ ë¶„ì„ ë³´ê¸° ğŸš€", type="primary"):
        st.session_state.step = 3
        st.rerun()

# =============================================================================
# [STEP 3] ê²°ê³¼ ë° ë¡œë“œë§µ
# =============================================================================
elif st.session_state.step == 3:
    st.markdown(f"<h1 class='main-header'>ğŸ¯ ë¶„ì„ ê²°ê³¼: [{st.session_state.holland_code}í˜•]</h1>", unsafe_allow_html=True)
    
    # 1. ì¶”ì²œ ì•Œê³ ë¦¬ì¦˜
    def calc_score(row):
        # ê°€ì¹˜ê´€ ì ìˆ˜ (ìœ í´ë¦¬ë“œ ê±°ë¦¬)
        job_vec = np.array([row['Money'], row['WLB'], row['Culture'], row['Location'], row['Stability']])
        user_vec = np.array(st.session_state.user_vector)
        value_match = 100 - np.linalg.norm(job_vec - user_vec)
        
        # í™€ë€ë“œ ë³´ë„ˆìŠ¤ (ì½”ë“œê°€ 1ê°œë¼ë„ ê²¹ì¹˜ë©´ ê°€ì‚°ì )
        holland_bonus = 0
        if st.session_state.holland_code[0] in row['Holland_Code']: holland_bonus += 5
        if st.session_state.holland_code[1] in row['Holland_Code']: holland_bonus += 3
        
        return value_match + holland_bonus

    df_jobs['Score'] = df_jobs.apply(calc_score, axis=1)
    top_jobs = df_jobs.sort_values('Score', ascending=False).head(5)
    
    # 2. ì¶”ì²œ ì§ì—… ë¦¬ìŠ¤íŠ¸
    st.markdown("### ğŸ† ë‹¹ì‹ ì„ ìœ„í•œ TOP 5 ì¶”ì²œ ì§ì—…")
    st.caption("ì•„ë˜ ì§ì—… ì¤‘ í•˜ë‚˜ë¥¼ ì„ íƒí•˜ë©´ ìƒì„¸ ë¡œë“œë§µì´ í¼ì³ì§‘ë‹ˆë‹¤.")
    
    job_options = top_jobs['ì§ì—…êµ°'].tolist()
    
    # ì„¸ì…˜ ìƒíƒœë¡œ ì„ íƒëœ ì§ì—… ìœ ì§€
    if 'selected_job_final' not in st.session_state:
        st.session_state.selected_job_final = job_options[0]

    # ë¼ë””ì˜¤ ë²„íŠ¼ì´ë‚˜ ì…€ë ‰íŠ¸ë°•ìŠ¤ë¡œ ì§ì—… ì„ íƒ
    st.session_state.selected_job_final = st.selectbox(
        "ğŸ‘‰ ìƒì„¸ ì •ë³´ë¥¼ í™•ì¸í•  ì§ì—…ì„ ì„ íƒí•˜ì„¸ìš”:",
        job_options
    )

    st.divider()

    # 3. ìƒì„¸ ë¡œë“œë§µ ë·°
    target_job = st.session_state.selected_job_final
    
    if target_job in career_guide:
        info = career_guide[target_job]
        
        st.markdown(f"## ğŸš© **{target_job}** ë§ˆìŠ¤í„° í”Œëœ")
        
        # [A] í•™ê³¼ ë° ê³ êµí•™ì ì œ
        c1, c2, c3 = st.columns(3)
        with c1:
            st.markdown(f"""<div class="info-box">
                <span class="info-title">ğŸ“ ëŒ€í•™ ì „ê³µ ì¶”ì²œ</span>
                <p>{info['major']}</p>
            </div>""", unsafe_allow_html=True)
        
        with c2:
            tags = "".join([f"<span class='tag-base tag-gen'>{s}</span>" for s in info['hs_g'].split(', ')])
            st.markdown(f"""<div class="info-box">
                <span class="info-title">ğŸ“˜ ê³ êµ ì¼ë°˜ì„ íƒ ê³¼ëª©</span>
                {tags}
            </div>""", unsafe_allow_html=True)
            
        with c3:
            tags = "".join([f"<span class='tag-base tag-career'>{s}</span>" for s in info['hs_c'].split(', ')])
            st.markdown(f"""<div class="info-box">
                <span class="info-title">ğŸš€ ê³ êµ ì§„ë¡œì„ íƒ ê³¼ëª©</span>
                {tags}
            </div>""", unsafe_allow_html=True)
            
        # [B] ë‹¨ê³„ë³„ ë¡œë“œë§µ
        st.write("")
        st.markdown("### ğŸ›¤ï¸ ì»¤ë¦¬ì–´ ë¡œë“œë§µ")
        
        for idx, step_text in enumerate(info['steps']):
            st.info(f"**STEP {idx+1}** : {step_text}")
            
    else:
        st.warning("ì„ íƒí•˜ì‹  ì§ì—…ì˜ ìƒì„¸ ë°ì´í„°ê°€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.")
