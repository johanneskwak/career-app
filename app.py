import streamlit as st
import pandas as pd
import plotly.graph_objects as go
import numpy as np

# -----------------------------------------------------------------------------
# 1. í˜ì´ì§€ ì„¤ì •
# -----------------------------------------------------------------------------
st.set_page_config(
    page_title="Career Balance & Holland",
    page_icon="ğŸ§­",
    layout="wide"
)

# -----------------------------------------------------------------------------
# 2. ë°ì´í„° ë¡œë“œ (ë¡œë“œë§µ ë°ì´í„° ì¶”ê°€)
# -----------------------------------------------------------------------------
@st.cache_data
def load_data():
    # 1. ì§ì—… ìŠ¤íƒ¯ ë°ì´í„°
    data = {
        'ì§ì—…êµ°': [
            'ì „ëµ ì»¨ì„¤í„´íŠ¸', 'ì™¸êµ­ê³„ íˆ¬ìì€í–‰(IB)', 'ëŒ€í˜• ë¡œíŒ ë³€í˜¸ì‚¬', 'ê³µì¸íšŒê³„ì‚¬(Big4)', 'ì‚¬ëª¨í€ë“œ(PE) ì‹¬ì‚¬ì—­',
            'ë„¤ì¹´ë¼ì¿ ë°° ê°œë°œì', 'ìœ ë‹ˆì½˜ ìŠ¤íƒ€íŠ¸ì—… ì§ì›', 'ê²Œì„ ê°œë°œì', 'AI ì—°êµ¬ì›/ì—”ì§€ë‹ˆì–´', 'ëŒ€ê¸°ì—… ì „ëµê¸°íš',
            'ì¦ê¶Œì‚¬ ë¸Œë¡œì»¤/PB', 'ì‹œì¤‘ì€í–‰ í–‰ì›', 'ê³µê¸°ì—… (ë©”ì´ì €)', 'ê³µê¸°ì—… (ì§€ë°©ê·¼ë¬´)', '7/9ê¸‰ ê³µë¬´ì›',
            '5ê¸‰ í–‰ì •ê³ ì‹œ ì‚¬ë¬´ê´€', 'ì´ˆë“±/ì¤‘ë“± êµì‚¬', 'ëŒ€í•™êµ êµì§ì›', 'ëŒ€í•™ êµìˆ˜', 'êµ­ì±…ì—°êµ¬ì†Œ ì—°êµ¬ì›',
            'ì˜ì‚¬ (ì „ë¬¸ì˜)', 'ì¹˜ê³¼ì˜ì‚¬', 'ì•½ì‚¬', 'ê°„í˜¸ì‚¬ (ëŒ€í•™ë³‘ì›)', 'ìˆ˜ì˜ì‚¬', 'í•œì˜ì‚¬',
            'ë°©ì†¡êµ­ PD', 'ë°©ì†¡ê¸°ì/ì•„ë‚˜ìš´ì„œ', 'ì›¹íˆ°/ì›¹ì†Œì„¤ ì‘ê°€', 'ì—”í„°í…Œì¸ë¨¼íŠ¸ A&R', 'ê´‘ê³ ê¸°íšì (AE)',
            'íŒ¨ì…˜ MD/ë°”ì´ì–´', 'í•­ê³µê¸° ì¡°ì¢…ì‚¬(íŒŒì¼ëŸ¿)', 'ê°ì‹¤ ìŠ¹ë¬´ì›', 'í˜¸í…”ë¦¬ì–´/ì§€ë°°ì¸', 'ì…°í”„/ìš”ë¦¬ì‚¬',
            'ë°˜ë„ì²´ ì—”ì§€ë‹ˆì–´', 'ë°°í„°ë¦¬/2ì°¨ì „ì§€ ì—°êµ¬ì›', 'ìë™ì°¨ ì—”ì§€ë‹ˆì–´', 'ì„ìœ í™”í•™/ì •ìœ  ì—”ì§€ë‹ˆì–´', 'ì œì•½/ë°”ì´ì˜¤ ì—°êµ¬ì›',
            'ê±´ì„¤/í† ëª© ì—”ì§€ë‹ˆì–´', 'ìŠ¤ë§ˆíŠ¸íŒœ ì „ë¬¸ê°€', 'ìŠ¤í¬ì¸  ì—ì´ì „íŠ¸/ë§ˆì¼€í„°', 'ì „ì‹œ/ê³µì—° ê¸°íšì', 'í†µë²ˆì—­ì‚¬',
            'ë…¸ë¬´ì‚¬', 'ê°ì •í‰ê°€ì‚¬', 'ê´€ì„¸ì‚¬', 'ë³€ë¦¬ì‚¬', '1ì¸ í¬ë¦¬ì—ì´í„°/ìœ íŠœë²„',
            'ì›Œì¼€ì´ì…˜ í”„ë¦¬ëœì„œ', 'ê³µê°„/ì¸í…Œë¦¬ì–´ ë””ìì´ë„ˆ', 'ë©”íƒ€ë²„ìŠ¤/VR í¬ë¦¬ì—ì´í„°', 'ë°ì´í„° ì‚¬ì´ì–¸í‹°ìŠ¤íŠ¸'
        ],
        'Holland_Code': [
            'EC', 'EC', 'EI', 'CE', 'EC', 'IR', 'EI', 'IR', 'IR', 'EC',
            'ES', 'CS', 'CS', 'CS', 'CS', 'ES', 'SA', 'CS', 'IA', 'IR',
            'IS', 'IR', 'SC', 'SI', 'IR', 'IS', 'AE', 'AE', 'AI', 'AE', 'AE',
            'AE', 'RI', 'SE', 'SE', 'RA', 'RI', 'RI', 'RI', 'RI', 'IR',
            'RI', 'RE', 'ES', 'AE', 'AS', 'EC', 'EC', 'CE', 'IE', 'AE',
            'AE', 'AR', 'AI', 'IR'
        ],
        'Money': [50, 55, 50, 40, 50, 35, 25, 35, 40, 40, 45, 35, 25, 25, 15, 25, 15, 20, 30, 30, 45, 45, 30, 30, 35, 40, 25, 30, 35, 15, 25, 25, 45, 25, 15, 25, 45, 40, 40, 45, 35, 40, 30, 25, 20, 30, 35, 40, 35, 45, 25, 20, 25, 30, 45],
        'WLB': [5, 5, 5, 10, 10, 20, 15, 15, 15, 15, 10, 25, 30, 30, 35, 10, 30, 35, 20, 30, 10, 15, 30, 10, 20, 25, 5, 5, 15, 10, 10, 10, 15, 15, 15, 5, 10, 15, 20, 20, 25, 5, 25, 10, 10, 25, 25, 20, 25, 10, 10, 35, 10, 20, 20],
        'Culture': [10, 5, 10, 10, 10, 15, 35, 25, 15, 10, 10, 10, 10, 5, 5, 10, 15, 10, 15, 10, 10, 10, 10, 10, 10, 10, 30, 15, 25, 35, 25, 20, 10, 15, 15, 15, 10, 15, 10, 5, 15, 10, 15, 20, 25, 15, 10, 5, 10, 10, 45, 20, 25, 25, 15],
        'Location': [20, 20, 20, 20, 15, 10, 10, 10, 10, 15, 15, 10, 10, 10, 10, 25, 10, 10, 5, 10, 15, 10, 10, 25, 15, 5, 20, 25, 10, 25, 25, 25, 10, 25, 30, 30, 15, 10, 10, 10, 5, 20, 15, 25, 25, 15, 15, 15, 15, 15, 10, 10, 25, 10, 10],
        'Stability': [15, 15, 15, 20, 15, 20, 15, 15, 20, 20, 20, 20, 25, 30, 35, 30, 30, 25, 30, 20, 20, 20, 20, 25, 20, 20, 20, 25, 15, 15, 15, 20, 20, 20, 25, 25, 20, 20, 20, 20, 20, 25, 15, 20, 20, 15, 15, 20, 15, 20, 10, 15, 15, 15, 10]
    }
    
    # 2. ë¡œë“œë§µ ë°ì´í„° (Key: ì§ì—…êµ°, Value: ë‹¨ê³„ë³„ ë¦¬ìŠ¤íŠ¸)
    roadmaps = {
        "ëŒ€í˜• ë¡œíŒ ë³€í˜¸ì‚¬": [
            {"step": "1ï¸âƒ£ í•™ë¶€ ë‹¨ê³„ (GPA ê´€ë¦¬)", "desc": "âœ”ï¸ ëª©í‘œ í•™ì : 95ì  ì´ìƒ (ìµœìš°ì„ )\nâœ”ï¸ í† ìµ: P/F ì¶”ì„¸ì´ë‚˜ ê³ ë“ì  ê¶Œì¥\nâœ”ï¸ ë²•í•™ ê´€ë ¨ êµì–‘ ìˆ˜ê°•"},
            {"step": "2ï¸âƒ£ LEET (ë²•í•™ì ì„±ì‹œí—˜)", "desc": "âœ”ï¸ ê¸°ì¶œ ë¬¸ì œ ë¬´í•œ ë°˜ë³µ ë° ì˜¤ë‹µ ë¶„ì„\nâœ”ï¸ ì–¸ì–´ì´í•´/ì¶”ë¦¬ë…¼ì¦ ì‚¬ê³ ë ¥ í›ˆë ¨\nâœ”ï¸ í•™ì› ê°•ì˜ë³´ë‹¤ëŠ” 'ì²´í™”'ê°€ ì¤‘ìš”"},
            {"step": "3ï¸âƒ£ í¬ìŠ¤íŠ¸ ë¦¬íŠ¸ (ì„œë¥˜/ë©´ì ‘)", "desc": "âœ”ï¸ ìì†Œì„œ: ì§€ì› ë™ê¸°ì™€ ë²•ì¡°ì¸ ì ì„± ì—°ê²°\nâœ”ï¸ ë©´ì ‘: ì‹œì‚¬ ì´ìŠˆ ë° ë²•ì  ë…¼ë¦¬ì„± í‰ê°€\nâœ”ï¸ ì •ë³´ì²˜: 'ì„œë¡œì—°' ë“± ì»¤ë®¤ë‹ˆí‹° í™œìš©"},
            {"step": "4ï¸âƒ£ ë¡œìŠ¤ì¿¨ ì…í•™ í›„", "desc": "âœ”ï¸ 1í•™ë…„: ë¯¼ë²• ë“± ê¸°ë³¸ 3ë²• ì˜¬ì¸\nâœ”ï¸ 2í•™ë…„: ê²€ì°°/ë¡œí´ëŸ­/ëŒ€í˜•íŒ ì¸í„´ì‹­ ì¤€ë¹„\nâœ”ï¸ 3í•™ë…„: ë³€í˜¸ì‚¬ ì‹œí—˜ í•©ê²© ëª©í‘œ"}
        ],
        "5ê¸‰ í–‰ì •ê³ ì‹œ ì‚¬ë¬´ê´€": [
            {"step": "1ï¸âƒ£ ì§„ì… ê²°ì • & PSAT", "desc": "âœ”ï¸ 1ì°¨ ê´€ë¬¸: PSAT(ì–¸ì–´/ìë£Œ/ìƒí™©)\nâœ”ï¸ í•œêµ­ì‚¬ 1ê¸‰, í† ìµ 700ì  ë¯¸ë¦¬ ì·¨ë“\nâœ”ï¸ 'ê¸°ì¶œ ë¶„ì„'ì´ PSATì˜ í•µì‹¬"},
            {"step": "2ï¸âƒ£ 2ì°¨ ì „ê³µ ì‹œí—˜ (í•µì‹¬)", "desc": "âœ”ï¸ ê²½ì œí•™, í–‰ì •ë²•, í–‰ì •í•™, ì •ì¹˜í•™ ë“±\nâœ”ï¸ ë…¼ìˆ í˜• ì‹œí—˜: ë‹µì•ˆì§€ ì‘ì„± ìŠ¤í„°ë”” í•„ìˆ˜\nâœ”ï¸ ì‹ ë¦¼ë™(ëŒ€í•™ë™) ìˆœí™˜ ê°•ì˜ ìˆ˜ê°•"},
            {"step": "3ï¸âƒ£ 3ì°¨ ë©´ì ‘", "desc": "âœ”ï¸ ê³µì§ê°€ì¹˜ê´€, ì§ë¬´ì—­ëŸ‰ í‰ê°€\nâœ”ï¸ ê·¸ë£¹ í† ì˜ ë° ê°œì¸ ë°œí‘œ ì¤€ë¹„\nâœ”ï¸ í•™êµ ê³ ì‹œë°˜ í™œìš© ì¶”ì²œ"}
        ],
        "ë„¤ì¹´ë¼ì¿ ë°° ê°œë°œì": [
            {"step": "1ï¸âƒ£ ê¸°ë³¸ê¸° ë‹¤ì§€ê¸°", "desc": "âœ”ï¸ CS ì§€ì‹: ìë£Œêµ¬ì¡°, ì•Œê³ ë¦¬ì¦˜, ë„¤íŠ¸ì›Œí¬\nâœ”ï¸ ì–¸ì–´ í•˜ë‚˜ ê¹Šê²Œ íŒŒê¸° (Python, Java, JS)\nâœ”ï¸ ë°±ì¤€/í”„ë¡œê·¸ë˜ë¨¸ìŠ¤ ë¬¸ì œ í’€ì´ (ê³¨ë“œ/ë ˆë²¨3 ëª©í‘œ)"},
            {"step": "2ï¸âƒ£ í”„ë¡œì íŠ¸ ê²½í—˜", "desc": "âœ”ï¸ í´ë¡  ì½”ë”©ë³´ë‹¤ëŠ” 'ë‚˜ë§Œì˜ ì„œë¹„ìŠ¤' ë§Œë“¤ê¸°\nâœ”ï¸ Git í˜‘ì—… ê²½í—˜(Commit/PR ê´€ë¦¬) í•„ìˆ˜\nâœ”ï¸ ë°°í¬ ë° ìš´ì˜ ê²½í—˜ (AWS ë“±)"},
            {"step": "3ï¸âƒ£ ì±„ìš© ì „í˜•", "desc": "âœ”ï¸ ì„œë¥˜: ê¸°ìˆ  ìŠ¤íƒê³¼ í•´ê²°í•œ ë¬¸ì œ ìœ„ì£¼ ì‘ì„±\nâœ”ï¸ ì½”ë”©í…ŒìŠ¤íŠ¸: ì˜¨ë¼ì¸ í…ŒìŠ¤íŠ¸ í†µê³¼\nâœ”ï¸ ê¸°ìˆ  ë©´ì ‘: í”„ë¡œì íŠ¸ ê¹Šì´ ìˆëŠ” ì§ˆë¬¸ ëŒ€ë¹„"}
        ]
    }
    
    return pd.DataFrame(data), roadmaps

df, roadmaps = load_data()

# -----------------------------------------------------------------------------
# 3. ë©”ì¸ íƒ€ì´í‹€
# -----------------------------------------------------------------------------
st.title("ğŸ§­ ì§„ë¡œ ë‚˜ì¹¨ë°˜ (Career Compass)")
st.markdown("##### ì ì„± ê²€ì‚¬ë¶€í„° ë¡œë“œë§µê¹Œì§€, ë‹¹ì‹ ì˜ ì§„ë¡œë¥¼ ì„¤ê³„í•˜ì„¸ìš”.")
st.divider()

# íƒ­ êµ¬ì„± (ë¡œë“œë§µ íƒ­ ì¶”ê°€ë¨!)
tab_holland, tab_balance, tab_roadmap, tab_result = st.tabs(["1ï¸âƒ£ í™€ë€ë“œ ì ì„±", "2ï¸âƒ£ ê°€ì¹˜ê´€ ì„¤ì •", "3ï¸âƒ£ ì¶”ì²œ ê²°ê³¼", "4ï¸âƒ£ ğŸ›¤ï¸ ì§„ë¡œ ë¡œë“œë§µ"])

# -----------------------------------------------------------------------------
# [TAB 1] í™€ë€ë“œ ì ì„± ê²€ì‚¬
# -----------------------------------------------------------------------------
with tab_holland:
    st.subheader("ë‚˜ì˜ í¥ë¯¸ ìœ í˜• ì°¾ê¸° (RIASEC)")
    st.write("ê° ì§ˆë¬¸ì— ëŒ€í•´ **ì–¼ë§ˆë‚˜ í¥ë¯¸ê°€ ìˆëŠ”ì§€** ì ìˆ˜ë¥¼ ë§¤ê²¨ì£¼ì„¸ìš”. (1~5ì )")
    
    col1, col2 = st.columns(2)
    with col1:
        score_R = st.slider("ğŸ”§ [R] ê¸°ê³„, ë„êµ¬, ì‚¬ë¬¼ ë‹¤ë£¨ê¸°", 1, 5, 3)
        score_I = st.slider("ğŸ”¬ [I] ê´€ì°°, íƒêµ¬, ë¶„ì„í•˜ê¸°", 1, 5, 3)
        score_A = st.slider("ğŸ¨ [A] ì°½ì˜ì , ì˜ˆìˆ ì  í™œë™", 1, 5, 3)
    with col2:
        score_S = st.slider("ğŸ¤ [S] íƒ€ì¸ ë•ê¸°, ê°€ë¥´ì¹˜ê¸°", 1, 5, 3)
        score_E = st.slider("ğŸ¤ [E] ì„¤ë“, ë¦¬ë“œ, ì„¸ì¼ì¦ˆ", 1, 5, 3)
        score_C = st.slider("ğŸ—‚ï¸ [C] ìë£Œ ì •ë¦¬, ê·œì¹™ ì¤€ìˆ˜", 1, 5, 3)

    scores = {'R': score_R, 'I': score_I, 'A': score_A, 'S': score_S, 'E': score_E, 'C': score_C}
    sorted_scores = sorted(scores.items(), key=lambda item: item[1], reverse=True)
    top_code = sorted_scores[0][0] + sorted_scores[1][0] 
    
    st.info(f"ğŸ‘‰ ë‹¹ì‹ ì˜ ì¶”ì • í™€ë€ë“œ ì½”ë“œëŠ” **[{top_code}]** ìœ í˜•ì…ë‹ˆë‹¤.")
    st.session_state['user_holland_code'] = top_code[0] 

# -----------------------------------------------------------------------------
# [TAB 2] ê°€ì¹˜ê´€ ë°¸ëŸ°ìŠ¤ ì„¤ì •
# -----------------------------------------------------------------------------
with tab_balance:
    st.subheader("ì§ì—… ê°€ì¹˜ê´€ ì„¤ì •")
    st.write("ì¤‘ìš”í•˜ê²Œ ìƒê°í•˜ëŠ” ìš”ì†Œì˜ **ë¹„ì¤‘**ì„ ì¡°ì ˆí•˜ì„¸ìš”.")
    
    val_money = st.slider("ğŸ’° ëˆ (Money)", 0, 100, 50)
    val_wlb = st.slider("ğŸ§˜ ì›Œë¼ë°¸ (WLB)", 0, 100, 50)
    val_culture = st.slider("ğŸ¨ ë¬¸í™” (Culture)", 0, 100, 20)
    val_location = st.slider("ğŸ“ ê·¼ë¬´ì§€ (Location)", 0, 100, 30)
    val_stability = st.slider("ğŸ›¡ï¸ ì•ˆì •ì„± (Stability)", 0, 100, 50)
    
    total_input = val_money + val_wlb + val_culture + val_location + val_stability
    if total_input == 0: total_input = 1

    user_vector = [
        (val_money / total_input) * 100,
        (val_wlb / total_input) * 100,
        (val_culture / total_input) * 100,
        (val_location / total_input) * 100,
        (val_stability / total_input) * 100
    ]
    
    fig = go.Figure()
    fig.add_trace(go.Bar(
        x=['Money', 'WLB', 'Culture', 'Location', 'Stability'],
        y=user_vector,
        marker_color=['#636EFA', '#EF553B', '#00CC96', '#AB63FA', '#FFA15A']
    ))
    fig.update_layout(title="ë‚˜ì˜ ê°€ì¹˜ê´€ ë¹„ì¤‘ (í™˜ì‚°ê°’)", yaxis_range=[0, 60], height=250, margin=dict(l=20, r=20, t=30, b=20))
    st.plotly_chart(fig, use_container_width=True)

# -----------------------------------------------------------------------------
# [TAB 3] ì¶”ì²œ ê²°ê³¼
# -----------------------------------------------------------------------------
with tab_result:
    st.subheader("ğŸ¯ AI ì§ì—… ì¶”ì²œ")
    
    if st.button("ì¶”ì²œ ì§ì—… ë³´ê¸° (Click)", type="primary"):
        def calculate_similarity(row):
            job_vector = np.array([row['Money'], row['WLB'], row['Culture'], row['Location'], row['Stability']])
            user_vec = np.array(user_vector)
            dist = np.linalg.norm(job_vector - user_vec)
            return 100 - dist

        df['Match_Score'] = df.apply(calculate_similarity, axis=1)
        user_type = st.session_state.get('user_holland_code', 'R') 
        
        best_match = df.sort_values(by='Match_Score', ascending=False).head(5)
        holland_match = df[df['Holland_Code'].str.contains(user_type)].sort_values(by='Match_Score', ascending=False).head(5)

        col_res1, col_res2 = st.columns(2)
        with col_res1:
            st.success("ğŸ† ê°€ì¹˜ê´€ ë§¤ì¹­ TOP 5")
            for idx, row in best_match.iterrows():
                st.markdown(f"**{row['ì§ì—…êµ°']}** ({row['Match_Score']:.1f}%)")
                st.progress(int(row['Match_Score']))
        
        with col_res2:
            st.info(f"ğŸ§© ì ì„±({user_type}í˜•) ê³ ë ¤ TOP 5")
            if not holland_match.empty:
                for idx, row in holland_match.iterrows():
                    st.markdown(f"**{row['ì§ì—…êµ°']}** ({row['Match_Score']:.1f}%)")
                    st.progress(int(row['Match_Score']))
            else:
                st.write("í•´ë‹¹ ìœ í˜• ë°ì´í„° ë¶€ì¡±")

# -----------------------------------------------------------------------------
# [TAB 4] ì§„ë¡œ ë¡œë“œë§µ (ìƒˆë¡œ ì¶”ê°€ëœ ê¸°ëŠ¥!)
# -----------------------------------------------------------------------------
with tab_roadmap:
    st.subheader("ğŸ›¤ï¸ ì§„ë¡œ ì¤€ë¹„ ë¡œë“œë§µ")
    st.write("ëª©í‘œ ì§ì—…ì„ ì„ íƒí•˜ë©´ **ë‹¨ê³„ë³„ ì¤€ë¹„ ì „ëµ**ì„ ë³´ì—¬ì¤ë‹ˆë‹¤.")
    
    # ë¡œë“œë§µ ë°ì´í„°ì— ìˆëŠ” ì§ì—…ë§Œ ì„ íƒì§€ë¡œ ì œê³µ
    track_list = list(roadmaps.keys())
    selected_track = st.selectbox("ì–´ë–¤ ì§„ë¡œê°€ ê¶ê¸ˆí•˜ì‹ ê°€ìš”?", track_list)
    
    st.divider()
    
    if selected_track:
        st.markdown(f"### ğŸš© **{selected_track}** í•©ê²© ë¡œë“œë§µ")
        
        # ë‹¨ê³„ë³„ ì¹´ë“œ ë³´ì—¬ì£¼ê¸°
        steps = roadmaps[selected_track]
        
        for step_info in steps:
            with st.expander(step_info["step"], expanded=True):
                st.markdown(step_info["desc"])
        
        st.success("ğŸ’¡ **Tip:** ìœ„ ë‹¨ê³„ëŠ” ì¼ë°˜ì ì¸ í•©ê²©ìë“¤ì˜ í‰ê· ì ì¸ ê²½ë¡œì…ë‹ˆë‹¤. ë³¸ì¸ì˜ ìƒí™©ì— ë§ì¶° ìœ ì—°í•˜ê²Œ ì ìš©í•˜ì„¸ìš”!")
        
    else:
        st.info("ìœ„ì—ì„œ ì§ì—…ì„ ì„ íƒí•´ì£¼ì„¸ìš”.")
